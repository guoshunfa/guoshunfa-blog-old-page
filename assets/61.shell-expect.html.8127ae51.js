import{_ as n,o as s,c as e,e as a}from"./app.4659d0e0.js";const t={},i=a(`<h1 id="shell-expect-ç”¨æ³•æè¿°" tabindex="-1"><a class="header-anchor" href="#shell-expect-ç”¨æ³•æè¿°" aria-hidden="true">#</a> Shell - expect ç”¨æ³•æè¿°</h1><h2 id="_1-expect-è‡ªåŠ¨åŒ–äº¤äº’è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_1-expect-è‡ªåŠ¨åŒ–äº¤äº’è„šæœ¬" aria-hidden="true">#</a> 1. expect è‡ªåŠ¨åŒ–äº¤äº’è„šæœ¬</h2><h3 id="_1-1-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-1-ä»‹ç»" aria-hidden="true">#</a> 1.1. ä»‹ç»</h3><p>expectæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–äº¤äº’å¥—ä»¶ï¼Œä¸»è¦åº”ç”¨äºæ‰§è¡Œå‘½ä»¤å’Œç¨‹åºæ—¶ï¼Œç³»ç»Ÿä»¥äº¤äº’å½¢å¼è¦æ±‚è¾“å…¥æŒ‡å®šå­—ç¬¦ä¸²ï¼Œå®ç°äº¤äº’é€šä¿¡ã€‚</p><h3 id="_1-2-å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_1-2-å®‰è£…" aria-hidden="true">#</a> 1.2. å®‰è£…</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">expect</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-å‘½ä»¤ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-3-å‘½ä»¤ä»‹ç»" aria-hidden="true">#</a> 1.3. å‘½ä»¤ä»‹ç»</h3><p>Expectä¸­æœ€å…³é”®çš„å››ä¸ªå‘½ä»¤æ˜¯send,expect,spawn,interactã€‚</p><ul><li><p>sendï¼šå‘è¿›ç¨‹å‘é€å­—ç¬¦ä¸²ï¼Œç”¨äºæ¨¡æ‹Ÿç”¨æˆ·çš„è¾“å…¥ï¼Œ è¯¥å‘½ä»¤ä¸èƒ½è‡ªåŠ¨å›è½¦æ¢è¡Œï¼Œä¸€èˆ¬è¦åŠ \\rï¼ˆå›è½¦ï¼‰</p></li><li><p>expectï¼š expectçš„ä¸€ä¸ªå†…éƒ¨å‘½ä»¤ï¼Œåˆ¤æ–­ä¸Šæ¬¡è¾“å‡ºç»“æœé‡Œæ˜¯å¦åŒ…å«æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰åˆ™ç«‹å³è¿”å›ï¼Œå¦åˆ™å°±ç­‰å¾…è¶…æ—¶æ—¶é—´åè¿”å›ï¼Œåªèƒ½æ•æ‰ç”±spawnå¯åŠ¨çš„è¿›ç¨‹çš„è¾“å‡ºexpect</p></li><li><p>spawnï¼šå¯åŠ¨è¿›ç¨‹ï¼Œå¹¶è·Ÿè¸ªåç»­äº¤äº’ä¿¡æ¯</p></li><li><p>interactï¼šæ‰§è¡Œå®Œæˆåä¿å­˜äº¤äº’çŠ¶æ€ï¼ŒæŠŠæ§åˆ¶æƒäº¤ç»™æ§åˆ¶å°</p></li><li><p>set timeout 30ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º30ç§’(é»˜è®¤çš„è¶…æ—¶æ—¶é—´æ˜¯ 10 ç§’ï¼Œé€šè¿‡ set å‘½ä»¤å¯ä»¥è®¾ç½®ä¼šè¯è¶…æ—¶æ—¶é—´, è‹¥ä¸é™åˆ¶è¶…æ—¶æ—¶é—´åˆ™åº”è®¾ç½®ä¸º-1)</p></li><li><p>exp_continueï¼š å…è®¸expectç»§ç»­å‘ä¸‹æ‰§è¡ŒæŒ‡ä»¤meoutï¼šæŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œè¿‡æœŸåˆ™ç»§ç»­æ‰§è¡Œåç»­æŒ‡ä»¤</p></li><li><p>send_userï¼š å›æ˜¾å‘½ä»¤ï¼Œç›¸å½“äºecho</p></li><li><p><code>$argv</code>å‚æ•°æ•°ç»„ï¼šExpectè„šæœ¬å¯ä»¥æ¥å—ä»bashä¼ é€’çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ [lindex <code>$argv</code> n] è·å¾—ï¼Œnä»0å¼€å§‹ï¼Œåˆ†åˆ«è¡¨ç¤ºç¬¬ä¸€ä¸ª<code>$1</code>ï¼Œç¬¬äºŒä¸ª<code>$2</code>ï¼Œç¬¬ä¸‰ä¸ª<code>$3</code>â€¦â€¦å‚æ•° (<code>$argvn</code>æ²¡æœ‰ç©ºæ ¼åˆ™è¡¨ç¤ºè„šæœ¬åç§° ï¼› <code>$argv</code> næœ‰ç©ºæ ¼åˆ™ä»£è¡¨ä¸‹æ ‡)</p></li></ul><p>ä¸€èˆ¬æµç¨‹ï¼šspawn å¯åŠ¨è¿½è¸ª â€”&gt; expect åŒ¹é…æ•æ‰å…³é”®å­— â€”â€”&gt; æ•æ‰åˆ°å°†è§¦å‘send ä»£æ›¿äººä¸ºè¾“å…¥æŒ‡ä»¤â€”&gt; interact /expect eof</p><p>Expectè„šæœ¬å¿…é¡»ä»¥interactæˆ–expect eof ç»“æŸï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ–ä»»åŠ¡é€šå¸¸expect eofå°±å¤Ÿäº†</p><p>expect eof æ˜¯åœ¨ç­‰å¾…ç»“æŸæ ‡å¿—ã€‚ç”±spawnå¯åŠ¨çš„å‘½ä»¤åœ¨ç»“æŸæ—¶ä¼šäº§ç”Ÿä¸€ä¸ªeofæ ‡è®°ï¼Œexpect eof å³åœ¨ç­‰å¾…è¿™ä¸ªæ ‡è®°</p><h3 id="_1-4-bash-shellå†…åŠ å…¥expectè„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_1-4-bash-shellå†…åŠ å…¥expectè„šæœ¬" aria-hidden="true">#</a> 1.4. bash shellå†…åŠ å…¥expectè„šæœ¬</h3><p>ä½¿ç”¨<code>&lt;&lt;-EOF</code> ï¼Œå¼•å…¥expectè„šæœ¬ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/base</span>
/usr/bin/expect <span class="token operator">&lt;&lt;-</span><span class="token string">EOF

EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-äº‹ä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-äº‹ä¾‹" aria-hidden="true">#</a> 2. äº‹ä¾‹</h2><h3 id="_2-1-ssh-è¿æ¥è¿œç«¯æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_2-1-ssh-è¿æ¥è¿œç«¯æœåŠ¡å™¨" aria-hidden="true">#</a> 2.1. ssh è¿æ¥è¿œç«¯æœåŠ¡å™¨</h3><p>1). å¼€å§‹æ„å»ºæ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> test_expect.exp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2). æ„å»ºæ–‡ä»¶å†…å®¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/expect</span>
<span class="token comment"># ä¼ å…¥å‚æ•°æ•°é‡éªŒè¯</span>
<span class="token keyword">if</span> <span class="token punctuation">{</span><span class="token variable">$argc</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
    <span class="token comment">#do something</span>
    send_user <span class="token string">&quot;usage: <span class="token variable">$argv0</span> &lt;remote_user&gt; &lt;remote_host&gt; &lt;remote_pwd&gt;&quot;</span>
    <span class="token builtin class-name">exit</span>
<span class="token punctuation">}</span>

// å°†è¶…æ—¶è®¾ç½®ä¸º-1ä»¥ç¦ç”¨è¶…æ—¶åŠŸèƒ½ã€‚
<span class="token builtin class-name">set</span> <span class="token function">timeout</span> <span class="token parameter variable">-1</span>

<span class="token comment"># è¿œç¨‹æœåŠ¡å™¨ç”¨æˆ·å</span>
<span class="token builtin class-name">set</span> remote_user <span class="token punctuation">[</span>lindex <span class="token variable">$argv</span> <span class="token number">0</span><span class="token punctuation">]</span> 
<span class="token comment"># è¿œç¨‹æœåŠ¡å™¨åŸŸå</span>
<span class="token builtin class-name">set</span> remote_host <span class="token punctuation">[</span>lindex <span class="token variable">$argv</span> <span class="token number">1</span><span class="token punctuation">]</span> 
<span class="token comment"># è¿œç¨‹æœåŠ¡å™¨å¯†ç </span>
<span class="token builtin class-name">set</span> remote_pwd <span class="token punctuation">[</span>lindex <span class="token variable">$argv</span> <span class="token number">2</span><span class="token punctuation">]</span>

<span class="token comment"># è¿œç¨‹ç™»å½•</span>
spawn <span class="token function">ssh</span> <span class="token variable">\${remote_user}</span>@<span class="token variable">\${remote_host}</span>
<span class="token function">expect</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;*password&quot;</span> <span class="token punctuation">{</span>send <span class="token string">&quot;<span class="token variable">\${remote_pwd}</span><span class="token entity" title="\\r">\\r</span>&quot;</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token string">&quot;*yes/no&quot;</span> <span class="token punctuation">{</span>send <span class="token string">&quot;yes<span class="token entity" title="\\r">\\r</span>&quot;</span><span class="token punctuation">;</span>exp_continue<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># sshç™»é™†æˆåŠŸåï¼Œç»§ç»­è¿›è¡Œæ“ä½œã€‚</span>
<span class="token function">expect</span> <span class="token string">&quot;]#&quot;</span> <span class="token punctuation">{</span> send <span class="token string">&quot;cd /<span class="token entity" title="\\r">\\r</span>&quot;</span> <span class="token punctuation">}</span>
<span class="token comment"># ç»“æŸ</span>
<span class="token function">expect</span> eof
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3). ä½¿ç”¨è„šæœ¬</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./test_expect.exp username <span class="token function">ip</span> password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ğŸŒŸ-æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#ğŸŒŸ-æ³¨æ„äº‹é¡¹" aria-hidden="true">#</a> ğŸŒŸ æ³¨æ„äº‹é¡¹</h2><ul><li>è„šæœ¬æ–‡ä»¶å†…å®¹ç¬¬ä¸€è¡Œå¿…é¡»åŠ å…¥<code>#!/usr/bin/expect</code>ã€‚</li><li>expect è„šæœ¬æ–‡ä»¶æ‰§è¡Œå¿…é¡»ä½¿ç”¨ ./test_expect.expã€‚</li></ul>`,25),c=[i];function p(l,o){return s(),e("div",null,c)}const r=n(t,[["render",p],["__file","61.shell-expect.html.vue"]]);export{r as default};
